<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>批发市场采购分析仪表板</title>
    <link rel="icon" href="/shared/logo/logoicon.png" />
    <link rel="stylesheet" href="./styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  </head>
  <body data-pattern="on">
    <div id="app">
      <header class="header">
        <h1>批发市场子系统—白条猪</h1>
        <div class="nav-filters">
          <div class="filter-group">
            <span class="filter-label">市场</span>
            <select class="nav-select-header" v-model="market" @change="handleMarketChange">
              <option v-for="m in markets" :key="m.value" :value="m.value">{{ m.label }}</option>
            </select>
          </div>
          
          <div class="filter-group">
            <span class="filter-label">日期</span>
            <input type="date" class="nav-datepicker-header" v-model="date" @change="handleDateChange" :min="minDate" :max="maxDate" />
          </div>
        </div>
        <nav class="nav-tabs" aria-label="顶部导航">
          <a href="#" class="nav-tab">首页</a>
          <a href="#" class="nav-tab">实时交易</a>
          <a href="../history/index.html" class="nav-tab">历史查询</a>
          <a href="#" class="nav-tab active">数据分析</a>
        </nav>
      </header>

      <div class="container">
        <aside class="sidebar" aria-label="左侧菜单">
          <div class="menu-item teal">❶ 交易量走势</div>
          <div class="menu-item orange">❷ 交易额走势</div>
          <div class="menu-item green">❸ 交易均价走势</div>
          <div class="menu-item orange">❹ 交易佣金费率走势</div>
          <div class="menu-item gray">❺ 16省猪平均出厂价与批发市场交易价走势</div>
          <div class="menu-item orange">❻ 交易佣金费走势</div>
          <div class="menu-item teal">❼ 分析报告</div>
        </aside>

        <main class="content">
          <div class="chart-card">
            <h3 class="chart-title">交易量趋势图</h3>
            <div id="trendChart"></div>
          </div>

          <div class="chart-card">
            <h3 class="chart-title">解读</h3>
            <div class="insights">暂无解读</div>
          </div>
          
          <div class="chart-card">
            <h3 class="chart-title">分析报告</h3>
            <div class="reports-controls">
              <div class="page-info">第 {{ currentPage }} / {{ totalPages }} 页 · 每页 {{ pageSize }} 条</div>
              <div class="pager">
                <button class="pager-btn" @click="prevPage" :disabled="currentPage===1">上一页</button>
                <button class="pager-btn" @click="nextPage" :disabled="currentPage===totalPages">下一页</button>
              </div>
            </div>
            <div class="reports-grid">
              <div class="report-card" :class="{placeholder: r.placeholder}" v-for="r in pageReports" :key="r.id">
                <template v-if="!r.placeholder">
                  <div class="report-header">
                    <div class="report-name">{{ r.name }}</div>
                    <div class="report-time">{{ r.uploadedAt }}</div>
                  </div>
                  <div class="report-summary">{{ r.summary }}</div>
                  <div class="report-actions">
                    <button class="btn" @click="preview(r)">预览</button>
                    <button class="btn outline" @click="download(r)">下载</button>
                  </div>
                </template>
                <div class="placeholder-body" v-else>
                  <div class="placeholder-title">空位</div>
                  <div class="placeholder-note">暂无报告</div>
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
      
      <div class="modal-mask" v-show="showPreview" @click.self="closePreview">
        <div class="modal">
          <div class="modal-header">
            <div class="modal-title">{{ previewReport && previewReport.name }}</div>
            <button class="modal-close" @click="closePreview">×</button>
          </div>
          <div class="modal-body">
            <div class="modal-meta">上传时间：{{ previewReport && previewReport.uploadedAt }}</div>
            <div class="modal-summary">{{ previewReport && previewReport.summary }}</div>
            <iframe v-if="previewReport && previewReport.fileUrl" :src="previewReport.fileUrl" class="modal-iframe"></iframe>
            <div v-else class="modal-placeholder">暂无文件，已展示摘要内容。</div>
          </div>
        </div>
      </div>
    </div>

    <script src="./app.js"></script>
  </body>
</html>
