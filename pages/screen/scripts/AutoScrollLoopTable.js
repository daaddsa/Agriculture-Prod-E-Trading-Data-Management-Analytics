!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).AutoScrollLoopTable=t()}(this,function(){"use strict";var e={name:"AutoScrollLoopTable",mixins:[{methods:{checkGlobalData(){if(window._DS_DATA&&window._DS_DATA.dataSet&&this.element.data.dataSetName){const e=window._DS_DATA.dataSet[this.element.data.dataSetName];if(e&&JSON.stringify(this.element.data.default)!==JSON.stringify(e)){this.element.data.default=e;this.setOption&&this.setOption(!1);this.reset&&this.reset()}}},setDataAction(){if(this.element.data){if(1===this.element.data.getType&&this.element.data.dataSetName){this.checkGlobalData();setInterval(()=>{this.checkGlobalData()},1000)}let e=this.element.data.api.interval||10;if(3===this.element.data.getType&&(this.getData(),setInterval(()=>{this.getData()},1e3*e)),1===this.element.data.getType&&this.element.data.updateType&&"none"!==this.element.data.updateType){let e=this.element.data.optionUpdateFreq||3;setInterval(()=>{this.createVirtualData()},1e3*e)}}},createVirtualData(){const e=dsDataUpdatesFuns[this.element.data.updateType](this.element.data,this.element.data.default);this.element.data.default=e,this.setOption&&this.setOption(!1),this.reset&&this.reset()},async getData(){try{const e=new URLSearchParams(window.location.search).get("scene");let t=this.element.data.api.params?JSON.parse(this.element.data.api.params):{},i=this.element.data.api.header&&"[]"!==this.element.data.api.header?JSON.parse(this.element.data.api.header):{};if(e){t.scene=e;for(let t in header)"{{scene}}"===i[t]&&(i[t]=e)}const n=this.element.data.api.url,a=this.element.data.api.method?.toLowerCase()||"get";let s=n,o={method:a,headers:{"Content-Type":"application/json",...i}};if("get"===a){s=`${n}?${new URLSearchParams(t)}`}else"post"===a&&(o.body=JSON.stringify(t));const d=await fetch(s,o);if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const l=await d.json();this.element.data.default=l.data,this.setOption&&this.setOption(!1),this.reset&&this.reset()}catch(e){console.error("请求API出错",e)}}}}],props:{uid:{type:String,required:!0},element:{type:Object,required:!0}},data:()=>({header:[],body:[],columnWidth:[],duration:10,isPaused:!1,rowHeight:40,headerHeight:40,cellPadding:"0 12px",config:{},allRows:[],key:Date.now()}),computed:{gridTemplate(){return this.header.length>0?`repeat(${this.header.length}, minmax(0, 1fr))`:"1fr"},bodyHeight(){return console.log(this.uid,"current element.height:",this.element.height),Math.max(0,this.element.height-this.headerHeight)}},watch:{element:{handler(e,t){console.log(this.uid,"element changed!",{newVal:e,oldVal:t}),console.log("new height:",e.height,"type:",typeof e.height)},deep:!0}},mounted(){this.setOption(),this.setDataAction(),this.$nextTick(()=>{const e=document.getElementById(this.uid);!e||0!==e.offsetWidth&&0!==e.offsetHeight||(e.style.width=(this.element.width||300)+"px",e.style.height=(this.element.height||200)+"px")})},methods:{init(){console.log("[DEBUG]",this.uid,"raw height:",this.element.height,"type:",typeof this.element.height);const e=document.getElementById(this.uid);console.log("init",e.offsetWidth,e.offsetHeight),e.offsetWidth>0&&e.offsetHeight>0?(this.setOption(),this.setDataAction()):(e.style.width=this.element.width+"px",e.style.height=this.element.height+"px",setTimeout(()=>{this.init()},1e3))},setOption(){this.config=this.element.config?JSON.parse(JSON.stringify(this.element.config)):{},this.applyConfig(),this.applyData()},applyConfig(){const e={...this.element.config};this.duration=e.duration||10,this.rowHeight=e.rowHeight||40,this.headerHeight=e.headerHeight||40,this.cellPadding=`${e.paddingY||0}px ${e.paddingX||0}px`,console.log(this.uid,"element.height:",this.element.height,"headerHeight:",this.headerHeight)},applyData(){console.log(this.uid,"[applyData] called"),console.log("element.data:",this.element.data),console.log("config:",this.config);const e=JSON.parse(JSON.stringify(this.element.data?.default||{}));this.header=e.header||[],this.body=[],this.columnWidth=e?.columnWidth||[],this.config.showRank?(this.header=["#",...this.header],e.body.forEach((e,t)=>{e=[t+1,...e],this.body.push(e)}),this.columnWidth=[80,...this.columnWidth]):this.body=e.body||[],this.allRows=[...this.body,...this.body,...this.body],this.resume(),console.log(this.uid,"bodyHeight computed:",this.bodyHeight)},getRowBgColor(e){return e%this.body.length%2==0?this.config.oddRowBgColor||"#ffffff":this.config.evenRowBgColor||"#fafafa"},isImageUrl(e){if("string"!=typeof e)return!1;if(!/^https?:\/\//i.test(e))return!1;return/\.(jpg|jpeg|png|gif|webp|svg|bmp)(\?|$)/i.test(e)},pause(){this.isPaused=!0,this.$nextTick(()=>{const e=this.$refs.contentWrapper;e&&(e.style.animationPlayState="paused")})},resume(){this.isPaused=!1,this.$nextTick(()=>{const e=this.$refs.contentWrapper;e&&(e.style.animationPlayState="running")})}}};function t(e,t,i,n,a,s,o,d,l,h){"boolean"!=typeof o&&(l=d,d=o,o=!1);const r="function"==typeof i?i.options:i;let c;if(e&&e.render&&(r.render=e.render,r.staticRenderFns=e.staticRenderFns,r._compiled=!0,a&&(r.functional=!0)),n&&(r._scopeId=n),s?(c=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(s)},r._ssrRegister=c):t&&(c=o?function(e){t.call(this,h(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,d(e))}),c)if(r.functional){const e=r.render;r.render=function(t,i){return c.call(i),e(t,i)}}else{const e=r.beforeCreate;r.beforeCreate=e?[].concat(e,c):[c]}return i}const i="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function n(e){return(e,t)=>function(e,t){const n=i?t.media||"default":e,o=s[n]||(s[n]={ids:new Set,styles:[]});if(!o.ids.has(e)){o.ids.add(e);let i=t.source;if(t.map&&(i+="\n/*# sourceURL="+t.map.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),o.element||(o.element=document.createElement("style"),o.element.type="text/css",t.media&&o.element.setAttribute("media",t.media),void 0===a&&(a=document.head||document.getElementsByTagName("head")[0]),a.appendChild(o.element)),"styleSheet"in o.element)o.styles.push(i),o.element.styleSheet.cssText=o.styles.filter(Boolean).join("\n");else{const e=o.ids.size-1,t=document.createTextNode(i),n=o.element.childNodes;n[e]&&o.element.removeChild(n[e]),n.length?o.element.insertBefore(t,n[e]):o.element.appendChild(t)}}}(e,t)}let a;const s={};const o=e;var d=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"infinite-scroll-table",style:{width:(e.element.width||300)+"px",height:(e.element.height||200)+"px",fontSize:e.config.fontSize?e.config.fontSize+"px":void 0,fontWeight:e.config.fontWeight||"normal",fontFamily:e.config.fontFamily||"inherit",color:e.config.textColor||"#333",textAlign:e.config.textAlign||"left"},attrs:{id:e.uid}},[i("div",{staticClass:"header-row",style:{gridTemplateColumns:e.gridTemplate,height:e.headerHeight+"px",lineHeight:e.headerHeight+"px",backgroundColor:e.config.headerBgColor||"#f8f9fa"}},e._l(e.header,function(t,n){return i("div",{key:"h-"+n,staticClass:"cell",style:{width:e.columnWidth[n]?e.columnWidth[n]+"px":"auto",flex:e.columnWidth[n]?"none":1,padding:"0px "+e.config.paddingX+"px",justifyContent:e.config.textAlign||"left"}},[i("div",{staticClass:"text-box"},[e._v(e._s(t))])])}),0),e._v(" "),i("div",{staticClass:"body-container",style:{top:e.headerHeight+"px",height:e.bodyHeight+"px"},on:{mouseenter:e.pause,mouseleave:e.resume}},[i("div",{ref:"contentWrapper",staticClass:"scroll-content",style:{gridTemplateColumns:e.gridTemplate,animationDuration:e.duration+"s"}},e._l(e.allRows,function(t,n){return i("div",{key:n,staticClass:"data-row",style:{height:e.rowHeight+"px",lineHeight:e.rowHeight+"px",padding:e.config.paddingY+"px 0px",backgroundColor:e.getRowBgColor(n)}},e._l(t,function(t,n){return i("div",{key:n,staticClass:"cell",style:{width:e.columnWidth[n]?e.columnWidth[n]+"px":"auto",flex:e.columnWidth[n]?"none":1,padding:"0px "+e.config.paddingX+"px",justifyContent:e.config.textAlign||"left"}},[e.isImageUrl(t)?[i("img",{staticClass:"cell-img",style:{maxHeight:e.rowHeight-2+"px",maxWidth:"100%",objectFit:"contain"},attrs:{src:t,alt:""}})]:[i("div",{staticClass:"text-box",domProps:{innerHTML:e._s(t)}})]],2)}),0)}),0)])])};d._withStripped=!0;return t({render:d,staticRenderFns:[]},function(e){e&&e("data-v-82ab2de8_0",{source:"\n.infinite-scroll-table[data-v-82ab2de8] {\n  position: relative;\n  overflow: hidden;\n  box-sizing: border-box;\n}\n.header-row[data-v-82ab2de8] {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  /* display: grid; */\n  display: flex;\n  font-weight: bold;\n  z-index: 2;\n}\n.body-container[data-v-82ab2de8] {\n  position: absolute;\n  left: 0;\n  width: 100%;\n  overflow: hidden;\n  z-index: 1;\n}\n.scroll-content[data-v-82ab2de8] {\n  /* display: grid; */\n  /* display: flex; */\n  min-height: 1000px; /* 临时测试 */\n  animation: scrollUp-data-v-82ab2de8 linear infinite;\n}\n.data-row[data-v-82ab2de8] {\n  /* display: contents; */\n  display: flex;\n}\n.cell[data-v-82ab2de8] {\n  box-sizing: border-box;\n  display: flex;\n  flex: 1;\n  align-items: center;\n}\n.text-box[data-v-82ab2de8]{\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n@keyframes scrollUp-data-v-82ab2de8 {\n0% {\n    transform: translateY(0);\n}\n100% {\n    transform: translateY(-50%);\n}\n}\n",map:void 0,media:void 0})},o,"data-v-82ab2de8",false,undefined,!1,n,void 0,void 0)});
